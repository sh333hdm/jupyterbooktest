
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Model: Regression &#8212; Applied Statistics Projektarbeit</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Model: Klassifikation" href="classification.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Applied Statistics Projektarbeit</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Dieses Buch durchsuchen ..." aria-label="Dieses Buch durchsuchen ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Plan
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data.html">
   Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classification.html">
   Model: Klassifikation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Model: Regression
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Navigation umschalten" aria-controls="site-navigation"
                title="Navigation umschalten" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Laden Sie diese Seite herunter"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Quelldatei herunterladen" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="In PDF drucken"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Quell-Repository"><i
                    class="fab fa-github"></i>Repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fregression.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Öffnen Sie ein Problem"><i class="fas fa-lightbulb"></i>offenes Thema</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Vollbildmodus"
        title="Vollbildmodus"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Starten Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Inhalt
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#models-statsmodels">
   Models statsmodels
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#statsmodels-ols">
     Statsmodels OLS
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression-diagnostics">
     Regression Diagnostics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#statsmodel-lasso">
     Statsmodel Lasso
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#natural-spline-statsmodel">
     Natural Spline Statsmodel
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation">
     Evaluation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-sklearn">
   Model sklearn
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-ols">
     sklearn OLS
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-lasso">
     sklearn Lasso
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#sklearn-spline">
     sklearn Spline
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluation-sklearn">
     Evaluation Sklearn
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="model-regression">
<h1>Model: Regression<a class="headerlink" href="#model-regression" title="Permalink to this headline">¶</a></h1>
<p>In diesem Notebook werden verschieden Regressionsmodell angewendet, um den mittleren Immobilienpreis von Distrikten in Kalifornien vorherzusagen. Dabei ist die Anforderung an die Model einen RMSE von kleiner 70 Tsd. USD zu erzielen. Dann wird das Projekt als Erfolg gewertet.</p>
<p>Die Regressionsmodelle werden in diesem Notebook mit Statsmodels und der Bibliothek scikit-learn durchgeführt. Die Auswahl der Modelle wird beim jeweiligen Modell begründet und beschrieben. Grundlegend ist jedes Modell in <em>Data preperation</em>, <em>Build</em> und <em>Metrics und Validation</em> unterteilt. Für das beste Modell der jeweiligen Bibliothek wird eine Evaluation mit den Testdaten durchgeführt.</p>
<blockquote>
<div><p>Über diesen <a class="reference external" href="https://sh333hdm.github.io/jupyterbooktest/intro.html">Link</a> ist die Ansicht der Projektarbeit als Jupyter Book möglich.</p>
</div></blockquote>
<section id="models-statsmodels">
<h2>Models statsmodels<a class="headerlink" href="#models-statsmodels" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrices</span>
<span class="kn">from</span> <span class="nn">func</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.eval_measures</span> <span class="kn">import</span> <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat</span> <span class="kn">import</span> <span class="n">lzip</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<section id="statsmodels-ols">
<h3>Statsmodels OLS<a class="headerlink" href="#statsmodels-ols" title="Permalink to this headline">¶</a></h3>
<p><strong>Data preperation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">,</span> <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">split_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">fill_missingdata</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">add_feautures</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>
<span class="n">train_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
      <th>households_population</th>
      <th>total_rooms_households</th>
      <th>total_rooms_total_bedrooms</th>
      <th>geohash</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399.0</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR OCEAN</td>
      <td>below</td>
      <td>0.239201</td>
      <td>5.663073</td>
      <td>5.265664</td>
      <td>9mu</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398.0</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
      <td>0.331019</td>
      <td>6.107226</td>
      <td>6.582915</td>
      <td>9qh</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548.0</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
      <td>above</td>
      <td>0.343629</td>
      <td>5.930712</td>
      <td>5.779197</td>
      <td>9qc</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187.0</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.364103</td>
      <td>4.992958</td>
      <td>3.791444</td>
      <td>9mv</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>-122.43</td>
      <td>37.79</td>
      <td>25.0</td>
      <td>1637</td>
      <td>394.0</td>
      <td>649</td>
      <td>379</td>
      <td>5.0049</td>
      <td>460000.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
      <td>0.583975</td>
      <td>4.319261</td>
      <td>4.154822</td>
      <td>9q8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7616</th>
      <td>-118.22</td>
      <td>33.86</td>
      <td>16.0</td>
      <td>8732</td>
      <td>1489.0</td>
      <td>3944</td>
      <td>1493</td>
      <td>5.1948</td>
      <td>203500.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
      <td>0.378550</td>
      <td>5.848627</td>
      <td>5.864338</td>
      <td>9q5</td>
    </tr>
    <tr>
      <th>8767</th>
      <td>-118.39</td>
      <td>33.81</td>
      <td>35.0</td>
      <td>1008</td>
      <td>165.0</td>
      <td>391</td>
      <td>167</td>
      <td>3.7778</td>
      <td>487500.0</td>
      <td>NEAR OCEAN</td>
      <td>above</td>
      <td>0.427110</td>
      <td>6.035928</td>
      <td>6.109091</td>
      <td>9q5</td>
    </tr>
    <tr>
      <th>16388</th>
      <td>-121.30</td>
      <td>38.05</td>
      <td>52.0</td>
      <td>122</td>
      <td>26.0</td>
      <td>62</td>
      <td>25</td>
      <td>1.1500</td>
      <td>112500.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.403226</td>
      <td>4.880000</td>
      <td>4.692308</td>
      <td>9qc</td>
    </tr>
    <tr>
      <th>19949</th>
      <td>-119.37</td>
      <td>36.21</td>
      <td>35.0</td>
      <td>2228</td>
      <td>476.0</td>
      <td>1567</td>
      <td>449</td>
      <td>1.4455</td>
      <td>54100.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.286535</td>
      <td>4.962138</td>
      <td>4.680672</td>
      <td>9q7</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>-120.27</td>
      <td>39.35</td>
      <td>11.0</td>
      <td>2520</td>
      <td>401.0</td>
      <td>397</td>
      <td>165</td>
      <td>4.6650</td>
      <td>145600.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.415617</td>
      <td>15.272727</td>
      <td>6.284289</td>
      <td>9qf</td>
    </tr>
  </tbody>
</table>
<p>16511 rows × 15 columns</p>
</div></div></div>
</div>
<p><strong>Model 1 OLS: Build</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Als erstes Modell wir eine einfach lineare Regression gewählt. Als unabhängige Variable wir <em>median_income</em> gewählt, da das mittlere Einkommen eines Bezirks die höchste Korrelation zu <em>median_house_value</em> aufweist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm1</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model OLS 1: Metrics and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.470</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.470</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>1.465e+04</td> 
</tr>
<tr>
  <th>Date:</th>              <td>Wed, 19 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>19:31:32</td>      <th>  Log-Likelihood:    </th> <td>-2.1069e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 16511</td>       <th>  AIC:               </th>  <td>4.214e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 16509</td>       <th>  BIC:               </th>  <td>4.214e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     1</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
        <td></td>           <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>     <td> 4.624e+04</td> <td> 1479.396</td> <td>   31.257</td> <td> 0.000</td> <td> 4.33e+04</td> <td> 4.91e+04</td>
</tr>
<tr>
  <th>median_income</th> <td>  4.15e+04</td> <td>  342.835</td> <td>  121.056</td> <td> 0.000</td> <td> 4.08e+04</td> <td> 4.22e+04</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>3462.094</td> <th>  Durbin-Watson:     </th> <td>   1.993</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>7756.529</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 1.201</td>  <th>  Prob(JB):          </th> <td>    0.00</td>
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 5.347</td>  <th>  Cond. No.          </th> <td>    10.2</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<p>Die Kenngrößen in der summary() sind wie erwartet nicht besonders gut. Der Adj. R-squared liegt bei 0.47. Dieser besagt, dass unter 50% der Streuung der Werte durch das Modell korrekt vorhergesagt werden kann. Weitere Kenngrößen werden im Vergleich zum zweiten Modell betrachtet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">},</span> <span class="n">height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">ci</span><span class="o">=</span><span class="kc">None</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_16_0.png" src="_images/regression_16_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lm1</span><span class="p">,</span> <span class="n">rmse_lm1</span><span class="p">,</span> <span class="n">mse_lm1</span> <span class="o">=</span> <span class="n">metrics_stats</span><span class="p">(</span><span class="n">lm1</span><span class="p">,</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.4702
RMSE  84238.28
MSE:  7096088082.25
</pre></div>
</div>
</div>
</div>
<p>Ebenfalls liegt der RMSE mit 84.238 USD über dem Zielwert von 70 Tsd. USD. Das Modell kann dementsprechend nicht als Erfolg gewertet werden.</p>
<p><strong>Model 2 OLS: Build</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + total_rooms_total_bedrooms&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the regression predictions (as &quot;pred&quot;) to our DataFrame</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm2</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model 2 OLS: Metrics and Evaluate</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.505</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.505</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   8435.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Wed, 19 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>19:31:33</td>      <th>  Log-Likelihood:    </th> <td>-2.1012e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 16511</td>       <th>  AIC:               </th>  <td>4.202e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 16508</td>       <th>  BIC:               </th>  <td>4.203e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     2</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
               <td></td>                 <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                  <td> 1.257e+05</td> <td> 2723.597</td> <td>   46.138</td> <td> 0.000</td> <td>  1.2e+05</td> <td> 1.31e+05</td>
</tr>
<tr>
  <th>median_income</th>              <td> 5.328e+04</td> <td>  477.415</td> <td>  111.600</td> <td> 0.000</td> <td> 5.23e+04</td> <td> 5.42e+04</td>
</tr>
<tr>
  <th>total_rooms_total_bedrooms</th> <td>-2.504e+04</td> <td>  730.782</td> <td>  -34.258</td> <td> 0.000</td> <td>-2.65e+04</td> <td>-2.36e+04</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>3765.914</td> <th>  Durbin-Watson:     </th> <td>   1.986</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>11861.969</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 1.164</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 6.439</td>  <th>  Cond. No.          </th> <td>    29.6</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_regress_exog</span><span class="p">(</span><span class="n">lm2</span><span class="p">,</span> <span class="s2">&quot;median_income&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eval_env: 1
</pre></div>
</div>
<img alt="_images/regression_24_1.png" src="_images/regression_24_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_regress_exog</span><span class="p">(</span><span class="n">lm2</span><span class="p">,</span> <span class="s2">&quot;total_rooms_total_bedrooms&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eval_env: 1
</pre></div>
</div>
<img alt="_images/regression_25_1.png" src="_images/regression_25_1.png" />
</div>
</div>
<p>Im Vergleich zu Model 1 erreicht das Model 2 besser statistische Kenngröße. Der Adj. R-squared liegt bei ca. 3% über dem vom Model 1. Sowohl die Kenngröße der F-Statistik, wie auch AIC und BIC sind höher als bei Model 1.</p>
<blockquote>
<div><p>Hinweis: Zu diesem Modell wird ausführlich Regression Diagnostics durchgeführt.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lm2</span><span class="p">,</span> <span class="n">rmse_lm2</span><span class="p">,</span> <span class="n">mse_lm2</span> <span class="o">=</span> <span class="n">metrics_stats</span><span class="p">(</span><span class="n">lm2</span><span class="p">,</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.5054
RMSE  81394.62
MSE:  6625084040.2
</pre></div>
</div>
</div>
</div>
<p>Der RMSE liegt mit ca. 81,4 Tsd. USD immer noch deutlich über 70 Tsd. USD. Es muss dementsprechend ein geeigneteres Modell gefunden werden.</p>
<p><strong>Model 3 OLS: Build</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm3</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + C(ocean_proximity) + households_population + total_rooms_households +C(geohash) + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Im dritten Modell werden mehr Variablen aus dem ursprünglichen Datensatz berücksichtigt. Nicht miteingeschlossen werden:
Nicht im Modell berücksichtigt werden folgende Features</p>
<ul class="simple">
<li><p><em>longitude</em>, <em>latidue</em> (siehe Feauture Selection)</p></li>
<li><p><em>total_rooms</em>, <em>total__bedrooms</em>, <em>population</em> und <em>households</em>, da die Korrelation dieser Merkmale untereinander zu hoch ist (siehe Feauture Selection)</p></li>
<li><p><em>price_category</em>, da diese aus <em>median_house_value</em> abgeleitet wird</p></li>
<li><p><em>total_rooms_total_bedrooms</em>, da nach einmaliger Durchführung der Klassifikation ein p-Wert von P|z|=0.555 ermittelt wurde</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm3</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model OLS 3: Metrics and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.697</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.696</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   970.5</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Wed, 19 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>19:31:37</td>      <th>  Log-Likelihood:    </th> <td>-2.0608e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 16511</td>       <th>  AIC:               </th>  <td>4.122e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 16471</td>       <th>  BIC:               </th>  <td>4.125e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>    39</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                  <td></td>                    <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                        <td> 2.021e+04</td> <td> 1.06e+04</td> <td>    1.913</td> <td> 0.056</td> <td> -499.590</td> <td> 4.09e+04</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.INLAND]</th>     <td>-4.854e+04</td> <td> 1801.660</td> <td>  -26.943</td> <td> 0.000</td> <td>-5.21e+04</td> <td> -4.5e+04</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.ISLAND]</th>     <td> 1.214e+05</td> <td> 3.35e+04</td> <td>    3.627</td> <td> 0.000</td> <td> 5.58e+04</td> <td> 1.87e+05</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.NEAR BAY]</th>   <td>-1.555e+04</td> <td> 2222.785</td> <td>   -6.994</td> <td> 0.000</td> <td>-1.99e+04</td> <td>-1.12e+04</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.NEAR OCEAN]</th> <td> 7499.9029</td> <td> 1777.907</td> <td>    4.218</td> <td> 0.000</td> <td> 4015.012</td> <td>  1.1e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9mu]</th>                <td>-8.981e+04</td> <td> 1.01e+04</td> <td>   -8.867</td> <td> 0.000</td> <td> -1.1e+05</td> <td>   -7e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9mv]</th>                <td>-9.892e+04</td> <td> 1.15e+04</td> <td>   -8.622</td> <td> 0.000</td> <td>-1.21e+05</td> <td>-7.64e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9my]</th>                <td>-1.015e+05</td> <td> 1.99e+04</td> <td>   -5.101</td> <td> 0.000</td> <td> -1.4e+05</td> <td>-6.25e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9nz]</th>                <td>-4743.1943</td> <td> 6.46e+04</td> <td>   -0.073</td> <td> 0.941</td> <td>-1.31e+05</td> <td> 1.22e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9pp]</th>                <td>-1.722e+05</td> <td> 1.32e+04</td> <td>  -13.050</td> <td> 0.000</td> <td>-1.98e+05</td> <td>-1.46e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9pr]</th>                <td>-1.634e+05</td> <td> 1.31e+04</td> <td>  -12.488</td> <td> 0.000</td> <td>-1.89e+05</td> <td>-1.38e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9q3]</th>                <td>-3.657e+04</td> <td> 1.41e+04</td> <td>   -2.602</td> <td> 0.009</td> <td>-6.41e+04</td> <td>-9019.975</td>
</tr>
<tr>
  <th>C(geohash)[T.9q4]</th>                <td>-4.804e+04</td> <td> 1.07e+04</td> <td>   -4.479</td> <td> 0.000</td> <td>-6.91e+04</td> <td> -2.7e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q5]</th>                <td> -4.74e+04</td> <td> 1.01e+04</td> <td>   -4.671</td> <td> 0.000</td> <td>-6.73e+04</td> <td>-2.75e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q6]</th>                <td>-8.497e+04</td> <td> 1.11e+04</td> <td>   -7.644</td> <td> 0.000</td> <td>-1.07e+05</td> <td>-6.32e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q7]</th>                <td>-1.113e+05</td> <td> 1.07e+04</td> <td>  -10.429</td> <td> 0.000</td> <td>-1.32e+05</td> <td>-9.04e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q8]</th>                <td> 8403.5853</td> <td> 1.04e+04</td> <td>    0.808</td> <td> 0.419</td> <td> -1.2e+04</td> <td> 2.88e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q9]</th>                <td>-5.983e+04</td> <td> 1.02e+04</td> <td>   -5.879</td> <td> 0.000</td> <td>-7.98e+04</td> <td>-3.99e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qb]</th>                <td>-8.567e+04</td> <td> 1.05e+04</td> <td>   -8.125</td> <td> 0.000</td> <td>-1.06e+05</td> <td> -6.5e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qc]</th>                <td>-1.013e+05</td> <td> 1.03e+04</td> <td>   -9.793</td> <td> 0.000</td> <td>-1.22e+05</td> <td> -8.1e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qd]</th>                <td>-1.062e+05</td> <td> 1.05e+04</td> <td>  -10.077</td> <td> 0.000</td> <td>-1.27e+05</td> <td>-8.56e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qe]</th>                <td>-9.941e+04</td> <td> 1.28e+04</td> <td>   -7.748</td> <td> 0.000</td> <td>-1.25e+05</td> <td>-7.43e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qf]</th>                <td>-9.811e+04</td> <td> 1.12e+04</td> <td>   -8.750</td> <td> 0.000</td> <td> -1.2e+05</td> <td>-7.61e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qg]</th>                <td>-1.126e+05</td> <td> 3.82e+04</td> <td>   -2.946</td> <td> 0.003</td> <td>-1.88e+05</td> <td>-3.77e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qh]</th>                <td>-7.808e+04</td> <td> 1.02e+04</td> <td>   -7.644</td> <td> 0.000</td> <td>-9.81e+04</td> <td>-5.81e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qj]</th>                <td>-1.083e+05</td> <td> 1.24e+04</td> <td>   -8.751</td> <td> 0.000</td> <td>-1.33e+05</td> <td> -8.4e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qk]</th>                <td>-1.581e+05</td> <td> 1.62e+04</td> <td>   -9.774</td> <td> 0.000</td> <td> -1.9e+05</td> <td>-1.26e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9qm]</th>                <td>-1.303e+05</td> <td> 3.82e+04</td> <td>   -3.407</td> <td> 0.001</td> <td>-2.05e+05</td> <td>-5.53e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qn]</th>                <td>-1.377e+05</td> <td> 2.19e+04</td> <td>   -6.298</td> <td> 0.000</td> <td>-1.81e+05</td> <td>-9.49e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qs]</th>                <td>-9.411e+04</td> <td> 4.63e+04</td> <td>   -2.034</td> <td> 0.042</td> <td>-1.85e+05</td> <td>-3420.401</td>
</tr>
<tr>
  <th>C(geohash)[T.9r0]</th>                <td>-1.144e+05</td> <td> 1.22e+04</td> <td>   -9.358</td> <td> 0.000</td> <td>-1.38e+05</td> <td>-9.05e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r1]</th>                <td>-1.149e+05</td> <td> 1.11e+04</td> <td>  -10.379</td> <td> 0.000</td> <td>-1.37e+05</td> <td>-9.32e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r2]</th>                <td>-1.238e+05</td> <td> 1.62e+04</td> <td>   -7.661</td> <td> 0.000</td> <td>-1.55e+05</td> <td>-9.21e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r3]</th>                <td>-1.295e+05</td> <td>  1.7e+04</td> <td>   -7.607</td> <td> 0.000</td> <td>-1.63e+05</td> <td>-9.61e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r4]</th>                <td>-1.195e+05</td> <td> 1.46e+04</td> <td>   -8.208</td> <td> 0.000</td> <td>-1.48e+05</td> <td> -9.1e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r6]</th>                <td>-1.405e+05</td> <td>  2.8e+04</td> <td>   -5.020</td> <td> 0.000</td> <td>-1.95e+05</td> <td>-8.56e+04</td>
</tr>
<tr>
  <th>median_income</th>                    <td> 3.656e+04</td> <td>  300.678</td> <td>  121.594</td> <td> 0.000</td> <td>  3.6e+04</td> <td> 3.72e+04</td>
</tr>
<tr>
  <th>households_population</th>            <td> 3.152e+05</td> <td> 5507.765</td> <td>   57.224</td> <td> 0.000</td> <td> 3.04e+05</td> <td> 3.26e+05</td>
</tr>
<tr>
  <th>total_rooms_households</th>           <td>  974.2598</td> <td>  217.753</td> <td>    4.474</td> <td> 0.000</td> <td>  547.440</td> <td> 1401.080</td>
</tr>
<tr>
  <th>housing_median_age</th>               <td>  451.9391</td> <td>   45.263</td> <td>    9.985</td> <td> 0.000</td> <td>  363.218</td> <td>  540.660</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>3293.108</td> <th>  Durbin-Watson:     </th> <td>   1.998</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>14080.222</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.926</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 7.128</td>  <th>  Cond. No.          </th> <td>4.32e+03</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 4.32e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lm3</span><span class="p">,</span> <span class="n">rmse_lm3</span><span class="p">,</span> <span class="n">mse_lm3</span> <span class="o">=</span> <span class="n">metrics_stats</span><span class="p">(</span><span class="n">lm3</span><span class="p">,</span><span class="n">train_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.6968
RMSE  63731.02
MSE:  4061642561.4
</pre></div>
</div>
</div>
</div>
<p>Durch Model 3 konnte ein RMSE von 63.731 USD und damit unter der Grenze von 70 Tsd. USD erzielt werden. Erst nach Evaluation mit einem Testdatenset kann, dass Model Erfolg gewertet werden.</p>
</section>
<section id="regression-diagnostics">
<h3>Regression Diagnostics<a class="headerlink" href="#regression-diagnostics" title="Permalink to this headline">¶</a></h3>
<p><strong>Outliner and High-Leverage</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">influence_plot</span><span class="p">(</span><span class="n">lm2</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;cooks&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_23480</span><span class="o">/</span><span class="mf">2058726918.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">influence_plot</span><span class="p">(</span><span class="n">lm2</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;cooks&quot;</span><span class="p">)</span>

<span class="nn">~\anaconda3\lib\site-packages\statsmodels\graphics\regressionplots.py</span> in <span class="ni">influence_plot</span><span class="nt">(results, external, alpha, criterion, size, plot_alpha, ax, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">922</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">_influence_plot</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">infl</span><span class="p">,</span> <span class="n">external</span><span class="o">=</span><span class="n">external</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">923</span>                           <span class="n">criterion</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">924</span>                           <span class="n">plot_alpha</span><span class="o">=</span><span class="n">plot_alpha</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">925</span>     <span class="k">return</span> <span class="n">res</span>
<span class="g g-Whitespace">    </span><span class="mi">926</span> 

<span class="nn">~\anaconda3\lib\site-packages\statsmodels\graphics\regressionplots.py</span> in <span class="ni">_influence_plot</span><span class="nt">(results, influence, external, alpha, criterion, size, plot_alpha, ax, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span>     <span class="n">leverage</span> <span class="o">=</span> <span class="n">infl</span><span class="o">.</span><span class="n">hat_matrix_diag</span>
<span class="g g-Whitespace">    </span><span class="mi">884</span>     <span class="k">if</span> <span class="n">external</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">885</span>         <span class="n">resids</span> <span class="o">=</span> <span class="n">infl</span><span class="o">.</span><span class="n">resid_studentized_external</span>
<span class="g g-Whitespace">    </span><span class="mi">886</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">887</span>         <span class="n">resids</span> <span class="o">=</span> <span class="n">infl</span><span class="o">.</span><span class="n">resid_studentized</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\_libs\properties.pyx</span> in <span class="ni">pandas._libs.properties.CachedProperty.__get__</span><span class="nt">()</span>

<span class="nn">~\anaconda3\lib\site-packages\statsmodels\stats\outliers_influence.py</span> in <span class="ni">resid_studentized_external</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">661</span>         <span class="n">requires</span> <span class="n">leave</span> <span class="n">one</span> <span class="n">out</span> <span class="n">loop</span> <span class="k">for</span> <span class="n">observations</span>
<span class="g g-Whitespace">    </span><span class="mi">662</span>         <span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">663</span><span class="sd">         sigma_looo = np.sqrt(self.sigma2_not_obsi)</span>
<span class="g g-Whitespace">    </span><span class="mi">664</span><span class="sd">         return self.get_resid_studentized_external(sigma=sigma_looo)</span>
<span class="g g-Whitespace">    </span><span class="mi">665</span><span class="sd"> </span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\_libs\properties.pyx</span> in <span class="ni">pandas._libs.properties.CachedProperty.__get__</span><span class="nt">()</span>

<span class="nn">~\anaconda3\lib\site-packages\statsmodels\stats\outliers_influence.py</span> in <span class="ni">sigma2_not_obsi</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">796</span><span class="sd">         uses results from leave-one-observation-out loop</span>
<span class="g g-Whitespace">    </span><span class="mi">797</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">798</span>         <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_res_looo</span><span class="p">[</span><span class="s1">&#39;mse_resid&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">799</span> 
<span class="g g-Whitespace">    </span><span class="mi">800</span>     <span class="nd">@property</span>

<span class="nn">~\anaconda3\lib\site-packages\pandas\_libs\properties.pyx</span> in <span class="ni">pandas._libs.properties.CachedProperty.__get__</span><span class="nt">()</span>

<span class="nn">~\anaconda3\lib\site-packages\statsmodels\stats\outliers_influence.py</span> in <span class="ni">_res_looo</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">956</span>         <span class="n">cv_iter</span> <span class="o">=</span> <span class="n">LeaveOneOut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">957</span>         <span class="k">for</span> <span class="n">inidx</span><span class="p">,</span> <span class="n">outidx</span> <span class="ow">in</span> <span class="n">cv_iter</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">958</span>             <span class="n">res_i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_class</span><span class="p">(</span><span class="n">endog</span><span class="p">[</span><span class="n">inidx</span><span class="p">],</span> <span class="n">exog</span><span class="p">[</span><span class="n">inidx</span><span class="p">])</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">959</span>             <span class="n">params</span><span class="p">[</span><span class="n">outidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_i</span><span class="o">.</span><span class="n">params</span>
<span class="g g-Whitespace">    </span><span class="mi">960</span>             <span class="n">mse_resid</span><span class="p">[</span><span class="n">outidx</span><span class="p">]</span> <span class="o">=</span> <span class="n">res_i</span><span class="o">.</span><span class="n">mse_resid</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
<img alt="_images/regression_40_1.png" src="_images/regression_40_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm_cooksd</span> <span class="o">=</span> <span class="n">lm2</span><span class="o">.</span><span class="n">get_influence</span><span class="p">()</span><span class="o">.</span><span class="n">cooks_distance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Anzahl an Datensätzen:&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">critical_d</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Kritische Cook distance:&#39;</span><span class="p">,</span> <span class="n">critical_d</span><span class="p">)</span>
<span class="n">out_d</span> <span class="o">=</span> <span class="n">lm_cooksd</span> <span class="o">&gt;</span> <span class="n">critical_d</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Anzahl Datensätze mit kritischer Cooks distance:&quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">lm_cooksd</span><span class="p">[</span><span class="n">out_d</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Anzahl an Datensätzen: 16511
Kritische Cook distance: 0.00024226273393495245
Anzahl Datensätze mit kritischer Cooks distance: 1019
</pre></div>
</div>
</div>
</div>
<p>1019 Datensätzen besitzen eine kritische Cooks Distanz. Dabei handelt es sich um vermutliche <em>Outliner</em> mit <em>leverage</em>. Ein einfaches Vorgehen zu wählen werden diese Distrikte entfernt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Int64Index([15709, 15631,  4585, 10574, 17237,  4643,  5366,  4592,  5288,
            15700,
            ...
            18339, 14404, 12341,  4065, 15641, 20091,  4245,  5282, 16835,
             8767],
           dtype=&#39;int64&#39;, length=1019)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset_opt</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
<span class="n">train_dataset_opt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
      <th>households_population</th>
      <th>total_rooms_households</th>
      <th>total_rooms_total_bedrooms</th>
      <th>geohash</th>
      <th>y_pred</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399.0</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR OCEAN</td>
      <td>below</td>
      <td>0.239201</td>
      <td>5.663073</td>
      <td>5.265664</td>
      <td>9mu</td>
      <td>180544.513708</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398.0</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
      <td>0.331019</td>
      <td>6.107226</td>
      <td>6.582915</td>
      <td>9qh</td>
      <td>278180.815364</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548.0</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
      <td>above</td>
      <td>0.343629</td>
      <td>5.930712</td>
      <td>5.779197</td>
      <td>9qc</td>
      <td>156587.429451</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187.0</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.364103</td>
      <td>4.992958</td>
      <td>3.791444</td>
      <td>9mv</td>
      <td>98711.659404</td>
    </tr>
    <tr>
      <th>439</th>
      <td>-122.29</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>477</td>
      <td>119.0</td>
      <td>218</td>
      <td>106</td>
      <td>2.5682</td>
      <td>120000.0</td>
      <td>NEAR BAY</td>
      <td>below</td>
      <td>0.486239</td>
      <td>4.500000</td>
      <td>4.008403</td>
      <td>9q9</td>
      <td>219865.838358</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4083</th>
      <td>-118.38</td>
      <td>34.15</td>
      <td>36.0</td>
      <td>2933</td>
      <td>619.0</td>
      <td>1115</td>
      <td>579</td>
      <td>4.3036</td>
      <td>365900.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
      <td>0.519283</td>
      <td>5.065630</td>
      <td>4.738288</td>
      <td>9q5</td>
      <td>315029.218008</td>
    </tr>
    <tr>
      <th>7616</th>
      <td>-118.22</td>
      <td>33.86</td>
      <td>16.0</td>
      <td>8732</td>
      <td>1489.0</td>
      <td>3944</td>
      <td>1493</td>
      <td>5.1948</td>
      <td>203500.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
      <td>0.378550</td>
      <td>5.848627</td>
      <td>5.864338</td>
      <td>9q5</td>
      <td>294980.478761</td>
    </tr>
    <tr>
      <th>16388</th>
      <td>-121.30</td>
      <td>38.05</td>
      <td>52.0</td>
      <td>122</td>
      <td>26.0</td>
      <td>62</td>
      <td>25</td>
      <td>1.1500</td>
      <td>112500.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.403226</td>
      <td>4.880000</td>
      <td>4.692308</td>
      <td>9qc</td>
      <td>67794.945044</td>
    </tr>
    <tr>
      <th>19949</th>
      <td>-119.37</td>
      <td>36.21</td>
      <td>35.0</td>
      <td>2228</td>
      <td>476.0</td>
      <td>1567</td>
      <td>449</td>
      <td>1.4455</td>
      <td>54100.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.286535</td>
      <td>4.962138</td>
      <td>4.680672</td>
      <td>9q7</td>
      <td>24155.335531</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>-120.27</td>
      <td>39.35</td>
      <td>11.0</td>
      <td>2520</td>
      <td>401.0</td>
      <td>397</td>
      <td>165</td>
      <td>4.6650</td>
      <td>145600.0</td>
      <td>INLAND</td>
      <td>below</td>
      <td>0.415617</td>
      <td>15.272727</td>
      <td>6.284289</td>
      <td>9qf</td>
      <td>194963.307816</td>
    </tr>
  </tbody>
</table>
<p>15492 rows × 16 columns</p>
</div></div></div>
</div>
<p><strong>Non-linearity and heteroscedasticity</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_partregress_grid</span><span class="p">(</span><span class="n">lm2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>eval_env: 1
eval_env: 1
eval_env: 1
</pre></div>
</div>
<img alt="_images/regression_46_1.png" src="_images/regression_46_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_fitted_y</span> <span class="o">=</span> <span class="n">lm2</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="c1">#  Plot</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">model_fitted_y</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">lowess</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
                     <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> 
                     <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;lw&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_47_0.png" src="_images/regression_47_0.png" />
</div>
</div>
<ul class="simple">
<li><p>Es liegt keine ungleichmäßige Verteilung der residuals vor: Hinweis auf Heteroscedasticity</p></li>
<li><p>Vermutlich liegt auch keine lineare Beziehung vor, da die rote Linie sich von der Gestrichelten unterscheidet.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Breusch-Pagan Lagrange Multiplier test</span>

<span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lagrange multiplier statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;f-value&#39;</span><span class="p">,</span> <span class="s1">&#39;f p-value&#39;</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">lm2</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">lm3</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
<span class="n">lzip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Lagrange multiplier statistic&#39;, 1911.1282277715711),
 (&#39;p-value&#39;, 0.0),
 (&#39;f-value&#39;, 55.283578339195074),
 (&#39;f p-value&#39;, 0.0)]
</pre></div>
</div>
</div>
</div>
<p>Beide p-werte liegen deutlich unter 0.05. Daher wird die Null-Hypothese abgelehnt.
Diese Ergebnis ist ebenfalls ein Indikator für Heteroscedasticity. Eine mögliche Lösung ist in diesem Fall die Anwendung eines Regression Splines. Dies wird in einem der folgenenden Abschnitten untersucht.</p>
<p><strong>Non-normally distributed errors</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Jarque-Bera test</span>
<span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jarque-Bera&#39;</span><span class="p">,</span> <span class="s1">&#39;Chi^2 two-tail prob.&#39;</span><span class="p">,</span> <span class="s1">&#39;Skew&#39;</span><span class="p">,</span> <span class="s1">&#39;Kurtosis&#39;</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">lm2</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>

<span class="n">lzip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Jarque-Bera&#39;, 11861.969271208563),
 (&#39;Chi^2 two-tail prob.&#39;, 0.0),
 (&#39;Skew&#39;, 1.1637299076876573),
 (&#39;Kurtosis&#39;, 6.438780225717456)]
</pre></div>
</div>
</div>
</div>
<p>Der p-Wert liegt bei 0.0 damit wird die Nullhyptothese abgelehnt. Das ist ein Indikator für nicht normalverteilte <em>error terms</em>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Omnibus normtest</span>
<span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Chi^2&#39;</span><span class="p">,</span> <span class="s1">&#39;Two-tail probability&#39;</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">omni_normtest</span><span class="p">(</span><span class="n">lm2</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
<span class="n">lzip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Chi^2&#39;, 3765.9137109308194), (&#39;Two-tail probability&#39;, 0.0)]
</pre></div>
</div>
</div>
</div>
<p>Auch bei diesem Test wird die Nullhyptothese abgelehnt. Dies lässt ebenso auf nicht normalverteilte <em>error terms</em> schließen.</p>
<p>Da die Anzahl an Datensätzen sehr hoch ist, müssen die Fehler nicht normalverteilt sein. Grund dafür ist der zentrale Grenzwertsatz. Es werden keine weiteren Schritte unternommen.</p>
<p><strong>Correlation of error terms</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">durbin_watson</span><span class="p">(</span><span class="n">lm2</span><span class="o">.</span><span class="n">resid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.985747491177888
</pre></div>
</div>
</div>
</div>
<p>Der Wert liegt zwischen 1 und 2, aber sehr nah an der 2. Im ersten Schritt wird keine Korrelation der <em>error terms</em> angenommen.</p>
<p><strong>Collinearity</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Variance inflation factor</span>
<span class="n">y</span><span class="p">,</span> <span class="n">X</span> <span class="o">=</span> <span class="n">dmatrices</span><span class="p">(</span><span class="s1">&#39;median_house_value ~ median_income + total_rooms_total_bedrooms&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>

<span class="c1"># For each X, calculate VIF and save in dataframe</span>
<span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF Factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;Feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>

<span class="n">vif</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VIF Factor</th>
      <th>Feature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18.48</td>
      <td>Intercept</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.08</td>
      <td>median_income</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.08</td>
      <td>total_rooms_total_bedrooms</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Für dieses Modell liegt keine problematische Kollinearität in den Daten vor.</p>
<p><strong>Model OLS 3 opt: Build</strong></p>
<p>In diesem linearen Modell wird das Modell mit multipler linearer Regression auf die bereinigten Trainingsdaten nach der Regression Diagnostics angewendet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm3opt</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + C(ocean_proximity) + households_population + total_rooms_households +C(geohash) + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset_opt</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset_opt</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm3opt</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model OLS 3 opt: Metrics and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm3opt</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.754</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.753</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   1212.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Wed, 19 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>16:28:02</td>      <th>  Log-Likelihood:    </th> <td>-1.8954e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 15492</td>       <th>  AIC:               </th>  <td>3.792e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 15452</td>       <th>  BIC:               </th>  <td>3.795e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>    39</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                  <td></td>                    <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                        <td> 2.657e+04</td> <td> 8927.873</td> <td>    2.976</td> <td> 0.003</td> <td> 9067.712</td> <td> 4.41e+04</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.INLAND]</th>     <td>-4.381e+04</td> <td> 1438.307</td> <td>  -30.458</td> <td> 0.000</td> <td>-4.66e+04</td> <td> -4.1e+04</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.ISLAND]</th>     <td> 2.753e+04</td> <td> 5.06e+04</td> <td>    0.544</td> <td> 0.586</td> <td>-7.17e+04</td> <td> 1.27e+05</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.NEAR BAY]</th>   <td>-1.515e+04</td> <td> 1791.166</td> <td>   -8.456</td> <td> 0.000</td> <td>-1.87e+04</td> <td>-1.16e+04</td>
</tr>
<tr>
  <th>C(ocean_proximity)[T.NEAR OCEAN]</th> <td> 1.155e+04</td> <td> 1458.700</td> <td>    7.916</td> <td> 0.000</td> <td> 8687.116</td> <td> 1.44e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9mu]</th>                <td>-8.245e+04</td> <td> 8557.908</td> <td>   -9.634</td> <td> 0.000</td> <td>-9.92e+04</td> <td>-6.57e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9mv]</th>                <td>-8.148e+04</td> <td> 9570.227</td> <td>   -8.514</td> <td> 0.000</td> <td>   -1e+05</td> <td>-6.27e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9my]</th>                <td>-9.325e+04</td> <td> 1.73e+04</td> <td>   -5.377</td> <td> 0.000</td> <td>-1.27e+05</td> <td>-5.93e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9nz]</th>                <td> 2.172e+04</td> <td> 5.06e+04</td> <td>    0.429</td> <td> 0.668</td> <td>-7.75e+04</td> <td> 1.21e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9pp]</th>                <td>-1.481e+05</td> <td> 1.08e+04</td> <td>  -13.650</td> <td> 0.000</td> <td>-1.69e+05</td> <td>-1.27e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9pr]</th>                <td>-1.416e+05</td> <td> 1.07e+04</td> <td>  -13.207</td> <td> 0.000</td> <td>-1.63e+05</td> <td>-1.21e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9q3]</th>                <td> -4.35e+04</td> <td>  1.2e+04</td> <td>   -3.635</td> <td> 0.000</td> <td> -6.7e+04</td> <td>   -2e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q4]</th>                <td>-4.487e+04</td> <td> 9027.657</td> <td>   -4.971</td> <td> 0.000</td> <td>-6.26e+04</td> <td>-2.72e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q5]</th>                <td>-4.229e+04</td> <td> 8572.389</td> <td>   -4.934</td> <td> 0.000</td> <td>-5.91e+04</td> <td>-2.55e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q6]</th>                <td>-7.378e+04</td> <td> 9291.964</td> <td>   -7.940</td> <td> 0.000</td> <td> -9.2e+04</td> <td>-5.56e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q7]</th>                <td>-9.472e+04</td> <td> 8957.942</td> <td>  -10.574</td> <td> 0.000</td> <td>-1.12e+05</td> <td>-7.72e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q8]</th>                <td> 3927.7120</td> <td> 8793.857</td> <td>    0.447</td> <td> 0.655</td> <td>-1.33e+04</td> <td> 2.12e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9q9]</th>                <td>-4.772e+04</td> <td> 8595.585</td> <td>   -5.552</td> <td> 0.000</td> <td>-6.46e+04</td> <td>-3.09e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qb]</th>                <td>-6.528e+04</td> <td> 8865.548</td> <td>   -7.363</td> <td> 0.000</td> <td>-8.27e+04</td> <td>-4.79e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qc]</th>                <td>-8.454e+04</td> <td> 8714.604</td> <td>   -9.701</td> <td> 0.000</td> <td>-1.02e+05</td> <td>-6.75e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qd]</th>                <td>-9.002e+04</td> <td> 8868.124</td> <td>  -10.151</td> <td> 0.000</td> <td>-1.07e+05</td> <td>-7.26e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qe]</th>                <td>-7.646e+04</td> <td> 1.07e+04</td> <td>   -7.174</td> <td> 0.000</td> <td>-9.74e+04</td> <td>-5.56e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qf]</th>                <td>-7.422e+04</td> <td> 9371.415</td> <td>   -7.920</td> <td> 0.000</td> <td>-9.26e+04</td> <td>-5.58e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qg]</th>                <td>-8.893e+04</td> <td> 3.01e+04</td> <td>   -2.958</td> <td> 0.003</td> <td>-1.48e+05</td> <td>   -3e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qh]</th>                <td>-6.666e+04</td> <td> 8620.116</td> <td>   -7.733</td> <td> 0.000</td> <td>-8.36e+04</td> <td>-4.98e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qj]</th>                <td>-8.917e+04</td> <td> 1.03e+04</td> <td>   -8.673</td> <td> 0.000</td> <td>-1.09e+05</td> <td> -6.9e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qk]</th>                <td>-1.472e+05</td> <td> 1.41e+04</td> <td>  -10.434</td> <td> 0.000</td> <td>-1.75e+05</td> <td> -1.2e+05</td>
</tr>
<tr>
  <th>C(geohash)[T.9qm]</th>                <td>-1.177e+05</td> <td> 3.01e+04</td> <td>   -3.914</td> <td> 0.000</td> <td>-1.77e+05</td> <td>-5.87e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qn]</th>                <td>-1.016e+05</td> <td> 1.81e+04</td> <td>   -5.621</td> <td> 0.000</td> <td>-1.37e+05</td> <td>-6.62e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9qs]</th>                <td>-6.696e+04</td> <td> 3.63e+04</td> <td>   -1.844</td> <td> 0.065</td> <td>-1.38e+05</td> <td> 4206.726</td>
</tr>
<tr>
  <th>C(geohash)[T.9r0]</th>                <td> -9.18e+04</td> <td> 1.01e+04</td> <td>   -9.089</td> <td> 0.000</td> <td>-1.12e+05</td> <td> -7.2e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r1]</th>                <td>-9.168e+04</td> <td> 9248.049</td> <td>   -9.913</td> <td> 0.000</td> <td> -1.1e+05</td> <td>-7.36e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r2]</th>                <td>-1.004e+05</td> <td>  1.3e+04</td> <td>   -7.698</td> <td> 0.000</td> <td>-1.26e+05</td> <td>-7.48e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r3]</th>                <td>-1.069e+05</td> <td> 1.37e+04</td> <td>   -7.806</td> <td> 0.000</td> <td>-1.34e+05</td> <td>-8.01e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r4]</th>                <td>-9.511e+04</td> <td>  1.2e+04</td> <td>   -7.929</td> <td> 0.000</td> <td>-1.19e+05</td> <td>-7.16e+04</td>
</tr>
<tr>
  <th>C(geohash)[T.9r6]</th>                <td> -1.18e+05</td> <td> 2.21e+04</td> <td>   -5.334</td> <td> 0.000</td> <td>-1.61e+05</td> <td>-7.46e+04</td>
</tr>
<tr>
  <th>median_income</th>                    <td> 3.971e+04</td> <td>  278.596</td> <td>  142.536</td> <td> 0.000</td> <td> 3.92e+04</td> <td> 4.03e+04</td>
</tr>
<tr>
  <th>households_population</th>            <td> 2.323e+05</td> <td> 4698.554</td> <td>   49.436</td> <td> 0.000</td> <td> 2.23e+05</td> <td> 2.41e+05</td>
</tr>
<tr>
  <th>total_rooms_households</th>           <td> -222.5164</td> <td>  197.473</td> <td>   -1.127</td> <td> 0.260</td> <td> -609.586</td> <td>  164.553</td>
</tr>
<tr>
  <th>housing_median_age</th>               <td>  416.1106</td> <td>   37.110</td> <td>   11.213</td> <td> 0.000</td> <td>  343.371</td> <td>  488.850</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>1355.662</td> <th>  Durbin-Watson:     </th> <td>   1.975</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>2428.917</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.620</td>  <th>  Prob(JB):          </th> <td>    0.00</td>
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 4.491</td>  <th>  Cond. No.          </th> <td>4.40e+03</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 4.4e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lm3opt</span><span class="p">,</span> <span class="n">rmse_lm3opt</span><span class="p">,</span> <span class="n">mse_lm3opt</span> <span class="o">=</span> <span class="n">metrics_stats</span><span class="p">(</span><span class="n">lm3opt</span><span class="p">,</span><span class="n">train_dataset_opt</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7536
RMSE  49803.87
MSE:  2480425056.56
</pre></div>
</div>
</div>
</div>
<p>Für dieses Modell liegt der RMSE unter 50 Tsd. USD.  Wird nur diese Größe betrachtet handelt es hierbei um das beste Modell.</p>
</section>
<section id="statsmodel-lasso">
<h3>Statsmodel Lasso<a class="headerlink" href="#statsmodel-lasso" title="Permalink to this headline">¶</a></h3>
<p><strong>Model Lasso: Build</strong></p>
<p>Folgendes Modell basiert auf eine Recherche im Internet zur Anwendung von Lasso mit der Bibliothek Statsmodels. Mit dem Parameter <code class="docutils literal notranslate"><span class="pre">L1_wt</span></code> wird eine regularisiertes Modell nach Lasso umgesetzt. Zu dieser Umsetzung habe ich wenige Quelle gefunden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lmlasso</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span> <span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + C(ocean_proximity) + households_population + total_rooms_households + total_rooms_total_bedrooms+C(geohash)&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">fit_regularized</span><span class="p">(</span><span class="n">L1_wt</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lmlasso</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model Lasso: Metrics and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmse_lasso</span><span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">rmse</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">],</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">mse_lasso</span> <span class="o">=</span> <span class="nb">round</span> <span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">],</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE &quot;</span><span class="p">,</span><span class="n">rmse_lasso</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: &quot;</span><span class="p">,</span><span class="n">mse_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE  66740.06
MSE:  4454235922.2
</pre></div>
</div>
</div>
</div>
<p>Der RMSE liegt mit ca. 66,7 Tsd. USD unter 70 Tsd. USD.</p>
</section>
<section id="natural-spline-statsmodel">
<h3>Natural Spline Statsmodel<a class="headerlink" href="#natural-spline-statsmodel" title="Permalink to this headline">¶</a></h3>
<p><strong>Model Splines: Build</strong></p>
<p>Das Natural Splines Modell wir mit nur einer Variablen umgesetzt. Da <em>median_income</em> die höchste Korrelation  mit <em>median_house_value</em> aufweist wird dieser in das Modell einbezogen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrix</span>
<span class="n">transformed_x3</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(train,df = 3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spline</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">transformed_x3</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span><span class="o">=</span> <span class="n">spline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(train, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model Splines: Metrics and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spline</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>Generalized Linear Model Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>   <td>median_house_value</td> <th>  No. Observations:  </th>   <td> 16511</td>   
</tr>
<tr>
  <th>Model:</th>                   <td>GLM</td>        <th>  Df Residuals:      </th>   <td> 16508</td>   
</tr>
<tr>
  <th>Model Family:</th>         <td>Gaussian</td>      <th>  Df Model:          </th>   <td>     2</td>   
</tr>
<tr>
  <th>Link Function:</th>        <td>identity</td>      <th>  Scale:             </th> <td>7.0501e+09</td> 
</tr>
<tr>
  <th>Method:</th>                 <td>IRLS</td>        <th>  Log-Likelihood:    </th> <td>-2.1063e+05</td>
</tr>
<tr>
  <th>Date:</th>             <td>Wed, 19 Jan 2022</td>  <th>  Deviance:          </th> <td>1.1638e+14</td> 
</tr>
<tr>
  <th>Time:</th>                 <td>16:28:05</td>      <th>  Pearson chi2:      </th>  <td>1.16e+14</td>  
</tr>
<tr>
  <th>No. Iterations:</th>           <td>3</td>         <th>  Pseudo R-squ. (CS):</th>   <td>0.5935</td>   
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
           <td></td>             <th>coef</th>     <th>std err</th>      <th>z</th>      <th>P>|z|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>          <td> 2.137e+05</td> <td> 2081.252</td> <td>  102.694</td> <td> 0.000</td> <td>  2.1e+05</td> <td> 2.18e+05</td>
</tr>
<tr>
  <th>cr(train, df=3)[0]</th> <td>-1.637e+05</td> <td> 1833.977</td> <td>  -89.247</td> <td> 0.000</td> <td>-1.67e+05</td> <td> -1.6e+05</td>
</tr>
<tr>
  <th>cr(train, df=3)[1]</th> <td>-1.035e+04</td> <td> 2352.411</td> <td>   -4.401</td> <td> 0.000</td> <td> -1.5e+04</td> <td>-5742.739</td>
</tr>
<tr>
  <th>cr(train, df=3)[2]</th> <td> 3.878e+05</td> <td> 5468.656</td> <td>   70.907</td> <td> 0.000</td> <td> 3.77e+05</td> <td> 3.98e+05</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rmse_spline</span><span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">rmse</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">mse_spline</span> <span class="o">=</span> <span class="nb">round</span> <span class="p">(</span><span class="n">mse</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">],</span> <span class="n">y_pred</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE &quot;</span><span class="p">,</span><span class="n">rmse_spline</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE: &quot;</span><span class="p">,</span><span class="n">mse_spline</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE  83955.93
MSE:  7048597740.17
</pre></div>
</div>
</div>
</div>
<p>Da ein Ergebnis der Regression Diagnostic ist, dass Spline für diese Problem besser geeignet sind, entspricht das Ergebnis nicht den Erwartungen. Grund kann dafür das Einbeziehen nur einer Variable sein.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Natural spline with df=3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x24edf4e0508&gt;
</pre></div>
</div>
<img alt="_images/regression_90_1.png" src="_images/regression_90_1.png" />
</div>
</div>
</section>
<section id="evaluation">
<h3>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h3>
<p>Für die Evaluation werden die RMSE der einzelnen Modelle miteinander verglichen. Das Modell mit dem niedrigsten RMSE wird mit den Testdaten validiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RMSE OLS 1&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE OLS 2&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE OLS 3&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE OLS 3 opt&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE Lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE Spline&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Werte&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_lm1</span><span class="p">,</span> <span class="n">rmse_lm2</span><span class="p">,</span> <span class="n">rmse_lm3</span><span class="p">,</span> <span class="n">rmse_lm3opt</span><span class="p">,</span> <span class="n">rmse_lasso</span><span class="p">,</span> <span class="n">rmse_spline</span><span class="p">]</span> <span class="p">}</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span><span class="s1">&#39;Werte&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RMSE</th>
      <th>Werte</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>RMSE OLS 3 opt</td>
      <td>49803.87</td>
    </tr>
    <tr>
      <th>2</th>
      <td>RMSE OLS 3</td>
      <td>63731.02</td>
    </tr>
    <tr>
      <th>4</th>
      <td>RMSE Lasso</td>
      <td>66740.06</td>
    </tr>
    <tr>
      <th>1</th>
      <td>RMSE OLS 2</td>
      <td>81394.62</td>
    </tr>
    <tr>
      <th>5</th>
      <td>RMSE Spline</td>
      <td>83955.93</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RMSE OLS 1</td>
      <td>84238.28</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_dataset</span> <span class="o">=</span> <span class="n">add_feautures</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">fill_missingdata</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;y_pred&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm3opt</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;households_population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_households&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="s1">&#39;geohash&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_test</span><span class="p">,</span> <span class="n">rmse_test</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="n">metrics_stats</span><span class="p">(</span><span class="n">lm3opt</span><span class="p">,</span><span class="n">test_dataset</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7536
RMSE  63071.78
MSE:  3978049594.35
</pre></div>
</div>
</div>
</div>
<p>Das Modell kann als Erfolg gewertet werde, das Modell angewandt auf die Testdaten ebenfalls ein RMSE von unter 70 Tsd. USD erreicht.</p>
</section>
</section>
<section id="model-sklearn">
<h2>Model sklearn<a class="headerlink" href="#model-sklearn" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span><span class="p">,</span> <span class="n">make_column_selector</span> <span class="k">as</span> <span class="n">selector</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">Ridge</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">PolynomialFeatures</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>  


<span class="kn">from</span> <span class="nn">func</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre></div>
</div>
</div>
</div>
<section id="sklearn-ols">
<h3>sklearn OLS<a class="headerlink" href="#sklearn-ols" title="Permalink to this headline">¶</a></h3>
<p><strong>Data Preperation</strong></p>
<p>Zur Datenvorbereitung  mit der Bibliothek scikit-learn wird ein <em>preprocessor</em> angewendet. Der Aufbau des <em>preprocessors</em> ist im Notebook Data genauer beschrieben. In diesem Fall wird dieser über die Funktion erstellt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Split Test and Trainingsdata</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">add_feautures</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Feauture Selection </span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="s1">&#39;households_population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_households&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_total_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;geohash&#39;</span><span class="p">]]</span>
<span class="n">X_train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>median_income</th>
      <th>ocean_proximity</th>
      <th>housing_median_age</th>
      <th>households_population</th>
      <th>total_rooms_households</th>
      <th>total_rooms_total_bedrooms</th>
      <th>geohash</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14196</th>
      <td>3.2596</td>
      <td>NEAR OCEAN</td>
      <td>33.0</td>
      <td>0.270870</td>
      <td>5.017657</td>
      <td>4.985646</td>
      <td>9mu</td>
    </tr>
    <tr>
      <th>8267</th>
      <td>3.8125</td>
      <td>NEAR OCEAN</td>
      <td>49.0</td>
      <td>0.575342</td>
      <td>4.473545</td>
      <td>4.297332</td>
      <td>9q5</td>
    </tr>
    <tr>
      <th>17445</th>
      <td>4.1563</td>
      <td>NEAR OCEAN</td>
      <td>4.0</td>
      <td>0.367213</td>
      <td>5.645833</td>
      <td>5.731118</td>
      <td>9q4</td>
    </tr>
    <tr>
      <th>14265</th>
      <td>1.9425</td>
      <td>NEAR OCEAN</td>
      <td>36.0</td>
      <td>0.250353</td>
      <td>4.002817</td>
      <td>3.871935</td>
      <td>9mu</td>
    </tr>
    <tr>
      <th>2271</th>
      <td>3.5542</td>
      <td>INLAND</td>
      <td>43.0</td>
      <td>0.434783</td>
      <td>6.268421</td>
      <td>5.526682</td>
      <td>9qd</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>11284</th>
      <td>6.3700</td>
      <td>&lt;1H OCEAN</td>
      <td>35.0</td>
      <td>0.329787</td>
      <td>6.129032</td>
      <td>6.616915</td>
      <td>9qh</td>
    </tr>
    <tr>
      <th>11964</th>
      <td>3.0500</td>
      <td>INLAND</td>
      <td>33.0</td>
      <td>0.256132</td>
      <td>6.868597</td>
      <td>5.410526</td>
      <td>9qh</td>
    </tr>
    <tr>
      <th>5390</th>
      <td>2.9344</td>
      <td>&lt;1H OCEAN</td>
      <td>36.0</td>
      <td>0.300114</td>
      <td>3.986717</td>
      <td>3.692443</td>
      <td>9q5</td>
    </tr>
    <tr>
      <th>860</th>
      <td>5.7192</td>
      <td>&lt;1H OCEAN</td>
      <td>15.0</td>
      <td>0.314575</td>
      <td>6.395349</td>
      <td>5.988275</td>
      <td>9q9</td>
    </tr>
    <tr>
      <th>15795</th>
      <td>2.5755</td>
      <td>NEAR BAY</td>
      <td>52.0</td>
      <td>0.474227</td>
      <td>3.402576</td>
      <td>3.213688</td>
      <td>9q8</td>
    </tr>
  </tbody>
</table>
<p>16512 rows × 7 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">build_preprocessor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model OLS</strong></p>
<p>Das erste Modell, welches mit scikit-learn umsgesetzt wird, basiert ebenfalls auf der <em>Ordinary least squares</em>-Methode. Im Unterschied zu Statsmodel wird mit scikit-learn gleich eine Multiple-Regression durchgeführt, da diese deutlich bessere Ergebnisse erzielen konnte.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lm&#39;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-e0113085-b695-48e9-8996-12eeba641150 {color: black;background-color: white;}#sk-e0113085-b695-48e9-8996-12eeba641150 pre{padding: 0;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-toggleable {background-color: white;}#sk-e0113085-b695-48e9-8996-12eeba641150 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-e0113085-b695-48e9-8996-12eeba641150 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-e0113085-b695-48e9-8996-12eeba641150 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-e0113085-b695-48e9-8996-12eeba641150 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-e0113085-b695-48e9-8996-12eeba641150 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-e0113085-b695-48e9-8996-12eeba641150 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-estimator:hover {background-color: #d4ebff;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-item {z-index: 1;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-parallel-item:only-child::after {width: 0;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-e0113085-b695-48e9-8996-12eeba641150 div.sk-text-repr-fallback {display: none;}</style><div id="sk-e0113085-b695-48e9-8996-12eeba641150" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502F08&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502BC8&gt;)])),
                (&#x27;lm&#x27;, LinearRegression())])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ef4c257c-ff82-424b-b982-13b6cd91fd63" type="checkbox" ><label for="ef4c257c-ff82-424b-b982-13b6cd91fd63" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502F08&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502BC8&gt;)])),
                (&#x27;lm&#x27;, LinearRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="554497d4-c0bc-4154-816a-398d86c85926" type="checkbox" ><label for="554497d4-c0bc-4154-816a-398d86c85926" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502F08&gt;),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                handle_unknown=&#x27;ignore&#x27;))]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502BC8&gt;)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dc1ac33f-9959-49cf-88c7-9d90bf1c52f8" type="checkbox" ><label for="dc1ac33f-9959-49cf-88c7-9d90bf1c52f8" class="sk-toggleable__label sk-toggleable__label-arrow">num</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502F08&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="19d4c5d9-45fa-4341-b01f-9229eadb1d06" type="checkbox" ><label for="19d4c5d9-45fa-4341-b01f-9229eadb1d06" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7c73bf7b-acbd-43cc-9142-5b4723a469f9" type="checkbox" ><label for="7c73bf7b-acbd-43cc-9142-5b4723a469f9" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0de34808-f441-4b0d-87bd-a9decb6dc325" type="checkbox" ><label for="0de34808-f441-4b0d-87bd-a9decb6dc325" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EDF502BC8&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="01f9530c-9aa3-4464-bc98-c72dd4e8b7cd" type="checkbox" ><label for="01f9530c-9aa3-4464-bc98-c72dd4e8b7cd" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9363eefe-fc6e-4d41-831e-bff36a5eefbf" type="checkbox" ><label for="9363eefe-fc6e-4d41-831e-bff36a5eefbf" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;, handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="34eb80ad-8825-4694-b932-93aa61d200b0" type="checkbox" ><label for="34eb80ad-8825-4694-b932-93aa61d200b0" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">lm_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Metrcis and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lm</span><span class="p">,</span> <span class="n">rmse_lm</span><span class="p">,</span> <span class="n">mse_lm</span> <span class="o">=</span> <span class="n">metrics_sk</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7008
RMSE  63242.32
MSE:  3999591280.22
</pre></div>
</div>
</div>
</div>
<p>Durch die Wahl geeignter Variablen wird gleich zu Beginn ein Model mit einem RMSE unter 70 Tsd. USD erzielt.</p>
</section>
<section id="sklearn-lasso">
<h3>sklearn Lasso<a class="headerlink" href="#sklearn-lasso" title="Permalink to this headline">¶</a></h3>
<p><strong>Data preperation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-122.23</td>
      <td>37.88</td>
      <td>NaN</td>
      <td>880</td>
      <td>129.0</td>
      <td>322</td>
      <td>126</td>
      <td>8.3252</td>
      <td>NaN</td>
      <td>NEAR BAY</td>
      <td>below</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-122.22</td>
      <td>37.86</td>
      <td>21.0</td>
      <td>7099</td>
      <td>1106.0</td>
      <td>2401</td>
      <td>1138</td>
      <td>8.3014</td>
      <td>358500.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-122.24</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1467</td>
      <td>190.0</td>
      <td>496</td>
      <td>177</td>
      <td>7.2574</td>
      <td>352100.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1274</td>
      <td>235.0</td>
      <td>558</td>
      <td>219</td>
      <td>5.6431</td>
      <td>341300.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1627</td>
      <td>280.0</td>
      <td>565</td>
      <td>259</td>
      <td>3.8462</td>
      <td>342200.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20635</th>
      <td>-121.09</td>
      <td>39.48</td>
      <td>25.0</td>
      <td>1665</td>
      <td>374.0</td>
      <td>845</td>
      <td>330</td>
      <td>1.5603</td>
      <td>78100.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>20636</th>
      <td>-121.21</td>
      <td>39.49</td>
      <td>18.0</td>
      <td>697</td>
      <td>150.0</td>
      <td>356</td>
      <td>114</td>
      <td>2.5568</td>
      <td>77100.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>20637</th>
      <td>-121.22</td>
      <td>39.43</td>
      <td>17.0</td>
      <td>2254</td>
      <td>485.0</td>
      <td>1007</td>
      <td>433</td>
      <td>1.7000</td>
      <td>92300.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>20638</th>
      <td>-121.32</td>
      <td>39.43</td>
      <td>18.0</td>
      <td>1860</td>
      <td>409.0</td>
      <td>741</td>
      <td>349</td>
      <td>1.8672</td>
      <td>84700.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>20639</th>
      <td>-121.24</td>
      <td>39.37</td>
      <td>16.0</td>
      <td>2785</td>
      <td>616.0</td>
      <td>1387</td>
      <td>530</td>
      <td>2.3886</td>
      <td>89400.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
  </tbody>
</table>
<p>20640 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Split Test and Trainingsdata</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="s1">&#39;price_category&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">add_feautures</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">build_preprocessor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Bei der Vorbereitung der Daten für das Lasso-Modell werden keine weiteren Variablen ausgeschlossen, da dieses Model eine Feauture Selection durchführt.</p>
<p><strong>Model LassoCV: Build</strong></p>
<p>Zur Bestimmung des optimalen Hyperparameters wird hier eine Lasso Cross Validation angewendet. Dafür werden die Trainingsdaten in 5 Teilsets aufgeteilt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LassoCV_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;LassoCV&#39;</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">LassoCV_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 {color: black;background-color: white;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 pre{padding: 0;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-toggleable {background-color: white;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-estimator:hover {background-color: #d4ebff;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-item {z-index: 1;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-parallel-item:only-child::after {width: 0;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92 div.sk-text-repr-fallback {display: none;}</style><div id="sk-8ce88fcd-a36d-4f59-b7f1-7e07846f9f92" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;)])),
                (&#x27;LassoCV&#x27;, LassoCV(cv=5, max_iter=10000, random_state=0))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8fafb177-8530-4aba-b7fc-7e486b92779e" type="checkbox" ><label for="8fafb177-8530-4aba-b7fc-7e486b92779e" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;)])),
                (&#x27;LassoCV&#x27;, LassoCV(cv=5, max_iter=10000, random_state=0))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="11e7aed8-1828-4d80-8d36-024f6e96963a" type="checkbox" ><label for="11e7aed8-1828-4d80-8d36-024f6e96963a" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                handle_unknown=&#x27;ignore&#x27;))]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f1a92fda-47dd-490d-bbb9-c16078940846" type="checkbox" ><label for="f1a92fda-47dd-490d-bbb9-c16078940846" class="sk-toggleable__label sk-toggleable__label-arrow">num</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="16486f49-ee64-4bec-850c-ca9571389ba2" type="checkbox" ><label for="16486f49-ee64-4bec-850c-ca9571389ba2" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d34f8a91-2e4a-4a11-be10-61cf5b9095d6" type="checkbox" ><label for="d34f8a91-2e4a-4a11-be10-61cf5b9095d6" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9e0e1114-3d04-493d-a7c0-7b8547cec693" type="checkbox" ><label for="9e0e1114-3d04-493d-a7c0-7b8547cec693" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="762288bf-bd7a-4ee2-9f3e-ef9be0bb7e13" type="checkbox" ><label for="762288bf-bd7a-4ee2-9f3e-ef9be0bb7e13" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5720be53-adc1-4e3c-9371-4528c9288d86" type="checkbox" ><label for="5720be53-adc1-4e3c-9371-4528c9288d86" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;, handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a6461b79-b03c-4f9d-8080-b2a459f436b7" type="checkbox" ><label for="a6461b79-b03c-4f9d-8080-b2a459f436b7" class="sk-toggleable__label sk-toggleable__label-arrow">LassoCV</label><div class="sk-toggleable__content"><pre>LassoCV(cv=5, max_iter=10000, random_state=0)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">LassoCV_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Model LassoCV: Metrics and Evaluation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lasso</span><span class="p">,</span> <span class="n">rmse_lasso</span><span class="p">,</span> <span class="n">mse_lasso</span> <span class="o">=</span> <span class="n">metrics_sk</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7046
RMSE  62842.13
MSE:  3949133062.48
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">alpha</span> <span class="o">=</span> <span class="n">LassoCV_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;LassoCV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span>
<span class="n">alpha</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>79.85195644260375
</pre></div>
</div>
</div>
</div>
<p>Durch Auslesen des Attributs <code class="docutils literal notranslate"><span class="pre">alpha_</span></code> wird der am besten geeignte Hyperparameter ausgewählt. Dieser wird im folgenden auf die Lasso-Regression angewendet.</p>
<p><strong>Model Lasso Best Alpha: Build</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Lasso_alpha_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;Lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Lasso_alpha_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b {color: black;background-color: white;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b pre{padding: 0;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-toggleable {background-color: white;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-estimator:hover {background-color: #d4ebff;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-item {z-index: 1;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-parallel-item:only-child::after {width: 0;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-c5edf60a-3ba1-45da-a23d-f7541be2268b div.sk-text-repr-fallback {display: none;}</style><div id="sk-c5edf60a-3ba1-45da-a23d-f7541be2268b" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;)])),
                (&#x27;Lasso&#x27;, Lasso(alpha=79.85195644260375))])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8eb5bfc3-af79-4812-844e-0cc8aa794e74" type="checkbox" ><label for="8eb5bfc3-af79-4812-844e-0cc8aa794e74" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;)])),
                (&#x27;Lasso&#x27;, Lasso(alpha=79.85195644260375))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d9ac8152-1e3d-483b-b239-aec2b64a6f12" type="checkbox" ><label for="d9ac8152-1e3d-483b-b239-aec2b64a6f12" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                handle_unknown=&#x27;ignore&#x27;))]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cf409e87-48af-4b2e-9d05-a06ff2276a52" type="checkbox" ><label for="cf409e87-48af-4b2e-9d05-a06ff2276a52" class="sk-toggleable__label sk-toggleable__label-arrow">num</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811F948&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0b9b88e1-dc39-4a06-8161-ff96e897f5df" type="checkbox" ><label for="0b9b88e1-dc39-4a06-8161-ff96e897f5df" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="19366189-5c04-46a9-8318-24a3e7a26059" type="checkbox" ><label for="19366189-5c04-46a9-8318-24a3e7a26059" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="7dec42ad-a3cc-4164-a79a-6beadc21fa86" type="checkbox" ><label for="7dec42ad-a3cc-4164-a79a-6beadc21fa86" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE811FEC8&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f1b709c9-e710-4d47-9e68-dd41e5dca4e7" type="checkbox" ><label for="f1b709c9-e710-4d47-9e68-dd41e5dca4e7" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="672c72a9-68d1-490d-aa0b-90315c71aa0f" type="checkbox" ><label for="672c72a9-68d1-490d-aa0b-90315c71aa0f" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;, handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="1ace81fb-f2c5-482e-a448-f5ed48c812bd" type="checkbox" ><label for="1ace81fb-f2c5-482e-a448-f5ed48c812bd" class="sk-toggleable__label sk-toggleable__label-arrow">Lasso</label><div class="sk-toggleable__content"><pre>Lasso(alpha=79.85195644260375)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p><strong>Model Lasso Best Alpha: Metrics</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_lasso</span><span class="p">,</span> <span class="n">rmse_lasso</span><span class="p">,</span> <span class="n">mse_lasso</span> <span class="o">=</span> <span class="n">metrics_sk</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7046
RMSE  62842.13
MSE:  3949133062.48
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Lasso_alpha_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;Lasso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">importance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>47
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">importance</span><span class="p">)):</span>
    <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="nb">list</span>

<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">importance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:&gt;
</pre></div>
</div>
<img alt="_images/regression_138_1.png" src="_images/regression_138_1.png" />
</div>
</div>
<p>Der RMSE liegt unter 70 Tsd. USd. und entspricht demententsprechend den Anforderung an das Modell.</p>
</section>
<section id="sklearn-spline">
<h3>sklearn Spline<a class="headerlink" href="#sklearn-spline" title="Permalink to this headline">¶</a></h3>
<p><strong>Data preperation</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">transform_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Split Test and Trainingsdata</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span> <span class="o">=</span> <span class="n">add_feautures</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Feauture Selection </span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="s1">&#39;households_population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_households&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_total_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;geohash&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Im Gegensatz zu Statsmodels können bei scikit-lern mehr als eine Variable verwendet werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">preprocessor</span> <span class="o">=</span> <span class="n">build_preprocessor</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Splines: Build</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Splines_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;polynomialfeatures&#39;</span><span class="p">,</span> <span class="n">PolynomialFeatures</span><span class="p">()),</span>
    <span class="p">(</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">())</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Splines_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-ed4f0911-9fdd-4519-b49e-304df362126d {color: black;background-color: white;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d pre{padding: 0;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-toggleable {background-color: white;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-estimator:hover {background-color: #d4ebff;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-item {z-index: 1;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-parallel-item:only-child::after {width: 0;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-ed4f0911-9fdd-4519-b49e-304df362126d div.sk-text-repr-fallback {display: none;}</style><div id="sk-ed4f0911-9fdd-4519-b49e-304df362126d" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E88&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E48&gt;)])),
                (&#x27;polynomialfeatures&#x27;, PolynomialFeatures()),
                (&#x27;ridge&#x27;, Ridge())])</pre><b>Please rerun this cell to show the HTML repr or trust the notebook.</b></div><div class="sk-container" hidden><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3fed2a34-5af2-4c1a-9d81-769f5981eb52" type="checkbox" ><label for="3fed2a34-5af2-4c1a-9d81-769f5981eb52" class="sk-toggleable__label sk-toggleable__label-arrow">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[(&#x27;preprocessor&#x27;,
                 ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(strategy=&#x27;median&#x27;)),
                                                                  (&#x27;scaler&#x27;,
                                                                   StandardScaler())]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E88&gt;),
                                                 (&#x27;cat&#x27;,
                                                  Pipeline(steps=[(&#x27;imputer&#x27;,
                                                                   SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                                 strategy=&#x27;constant&#x27;)),
                                                                  (&#x27;onehot&#x27;,
                                                                   OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                                 handle_unknown=&#x27;ignore&#x27;))]),
                                                  &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E48&gt;)])),
                (&#x27;polynomialfeatures&#x27;, PolynomialFeatures()),
                (&#x27;ridge&#x27;, Ridge())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ed5a0614-2dd5-4406-91db-f156000a78f3" type="checkbox" ><label for="ed5a0614-2dd5-4406-91db-f156000a78f3" class="sk-toggleable__label sk-toggleable__label-arrow">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[(&#x27;num&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(strategy=&#x27;median&#x27;)),
                                                 (&#x27;scaler&#x27;, StandardScaler())]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E88&gt;),
                                (&#x27;cat&#x27;,
                                 Pipeline(steps=[(&#x27;imputer&#x27;,
                                                  SimpleImputer(fill_value=&#x27;missing&#x27;,
                                                                strategy=&#x27;constant&#x27;)),
                                                 (&#x27;onehot&#x27;,
                                                  OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;,
                                                                handle_unknown=&#x27;ignore&#x27;))]),
                                 &lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E48&gt;)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="486b4f61-3b41-4eb0-a549-55ef1d147c78" type="checkbox" ><label for="486b4f61-3b41-4eb0-a549-55ef1d147c78" class="sk-toggleable__label sk-toggleable__label-arrow">num</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E88&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="00c30cae-9f2c-4093-aa51-0cf40771e914" type="checkbox" ><label for="00c30cae-9f2c-4093-aa51-0cf40771e914" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy=&#x27;median&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="61faab60-b9f9-4651-8f70-eebd35169ca9" type="checkbox" ><label for="61faab60-b9f9-4651-8f70-eebd35169ca9" class="sk-toggleable__label sk-toggleable__label-arrow">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="636889a5-8e67-464a-aaac-324c9e786d65" type="checkbox" ><label for="636889a5-8e67-464a-aaac-324c9e786d65" class="sk-toggleable__label sk-toggleable__label-arrow">cat</label><div class="sk-toggleable__content"><pre>&lt;sklearn.compose._column_transformer.make_column_selector object at 0x0000024EE00C7E48&gt;</pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4d223005-6208-4c29-8ce7-dc27bbe59483" type="checkbox" ><label for="4d223005-6208-4c29-8ce7-dc27bbe59483" class="sk-toggleable__label sk-toggleable__label-arrow">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value=&#x27;missing&#x27;, strategy=&#x27;constant&#x27;)</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8e9f6c42-6b4d-4464-ae51-3f09b876ab06" type="checkbox" ><label for="8e9f6c42-6b4d-4464-ae51-3f09b876ab06" class="sk-toggleable__label sk-toggleable__label-arrow">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(dtype=&lt;class &#x27;int&#x27;&gt;, handle_unknown=&#x27;ignore&#x27;)</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5c2f80bc-ed16-474d-ac4f-b90581393aeb" type="checkbox" ><label for="5c2f80bc-ed16-474d-ac4f-b90581393aeb" class="sk-toggleable__label sk-toggleable__label-arrow">PolynomialFeatures</label><div class="sk-toggleable__content"><pre>PolynomialFeatures()</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b416ae9a-f368-4be2-bc10-d64cecd6d1cf" type="checkbox" ><label for="b416ae9a-f368-4be2-bc10-d64cecd6d1cf" class="sk-toggleable__label sk-toggleable__label-arrow">Ridge</label><div class="sk-toggleable__content"><pre>Ridge()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">Splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_spline</span><span class="p">,</span> <span class="n">rmse_spline</span><span class="p">,</span> <span class="n">mse_spline</span> <span class="o">=</span> <span class="n">metrics_sk</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7628
RMSE  56311.61
MSE:  3170997160.3
</pre></div>
</div>
</div>
</div>
<p>Der RMSE liegt mit 56,3 Tsd. USD deutlich unter 70 Tsd. USD.</p>
</section>
<section id="evaluation-sklearn">
<h3>Evaluation Sklearn<a class="headerlink" href="#evaluation-sklearn" title="Permalink to this headline">¶</a></h3>
<p><strong>Select best model</strong></p>
<p>Wie bei Statsmodel werden die RMSE-Werte zuerst verglichen und dann das beste Modell mit den Testdaten validiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;RMSE&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;RMSE OLS&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE Lasso&#39;</span><span class="p">,</span> <span class="s1">&#39;RMSE Spline&#39;</span><span class="p">],</span>
        <span class="s1">&#39;Werte&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_lm</span><span class="p">,</span> <span class="n">rmse_lasso</span><span class="p">,</span> <span class="n">rmse_spline</span><span class="p">]</span> <span class="p">}</span>
<span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">df_results</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span><span class="s1">&#39;Werte&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>RMSE</th>
      <th>Werte</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>RMSE Spline</td>
      <td>56311.61</td>
    </tr>
    <tr>
      <th>1</th>
      <td>RMSE Lasso</td>
      <td>62842.13</td>
    </tr>
    <tr>
      <th>0</th>
      <td>RMSE OLS</td>
      <td>63242.32</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Das beste Modell ist das Spline-Modell.</p>
<p><strong>Predict with test data</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test</span> <span class="o">=</span> <span class="n">add_feautures</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="s1">&#39;households_population&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_households&#39;</span><span class="p">,</span> <span class="s1">&#39;total_rooms_total_bedrooms&#39;</span><span class="p">,</span> <span class="s1">&#39;geohash&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">Splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Final Results</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_test</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">median</span><span class="p">(),</span> <span class="n">inplace</span><span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">r2_test</span><span class="p">,</span> <span class="n">rmse_test</span><span class="p">,</span> <span class="n">mse_test</span> <span class="o">=</span> <span class="n">metrics_sk</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2:  0.7366
RMSE  58720.25
MSE:  3448068054.55
</pre></div>
</div>
</div>
</div>
<p>Der RMSE der Testdaten liegt ebenfalls unter 70 Tsd. USD bei 58,7 Tsd. USD. Dieses Ergebnis ist besser als das durch Statsmodel erzielte.</p>
<p>Nach Anforderung kann auch die Regression als Erfolg gewertet werden.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="classification.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Model: Klassifikation</p>
        </div>
    </a>
</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          Durch Sophie Horn<br/>
        
            &copy; Urheberrechte © 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>